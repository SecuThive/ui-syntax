name: Daily Designs

on:
  schedule:
    - cron: "0 1 * * *" # 매일 01:00 UTC
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    services:
      ollama:
        image: ollama/ollama:latest
        options: >-
          --health-cmd="ollama --version"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=5
        ports:
          - 11434:11434
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Wait for Ollama to be ready
        run: |
          for i in {1..30}; do
            if curl -f http://localhost:11434/api/tags > /dev/null 2>&1; then
              echo "✅ Ollama is ready"
              exit 0
            fi
            echo "⏳ Waiting for Ollama... ($i/30)"
            sleep 10
          done
          echo "❌ Ollama failed to start"
          exit 1
      - name: Pull Ollama model
        run: |
          curl -X POST http://localhost:11434/api/pull -d '{"name": "neural-chat"}'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      - name: Run generator with Ollama
        env:
          API_BASE: ${{ secrets.API_BASE }}
          OLLAMA_BASE: http://localhost:11434
          OLLAMA_MODEL: neural-chat
        run: |
          python scripts/daily_designs_ollama.py

